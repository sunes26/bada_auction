# PlayAuto 카테고리 관리

## 용어 정리

- **ol_shop_no**: PlayAuto 내부 상품 번호 (PlayAuto에 등록 시 발급)
- **shop_sale_no**: 마켓플레이스 실제 상품 번호 (마켓에 전송 후 발급)
- **c_sale_cd**: 판매자 관리코드 (사용자가 지정하는 고유 코드)

## 채널별 shop_cd

| 채널 | shop_cd | opt_type | std_ol_yn | 비고 |
|------|---------|----------|-----------|------|
| 옥션 | A001 | 옵션없음 | Y | 단일상품 |
| 지마켓 | A006 | 옵션없음 | Y | 단일상품 |
| 스마트스토어 | A077 | 독립형 | N | |
| 쿠팡 | **B378** | 조합형 | N | 추천옵션 필수 |
| 11번가 | A112 | 독립형 | N | |
| SSG.COM | A524 | 독립형 | N | |
| 롯데ON | A113 | 독립형 | N | |
| GS SHOP | A522 | 독립형 | N | |

> ⚠️ **중요**: 실제 쿠팡 shop_cd는 **B378**입니다 (2026-02-08 확인)

## opt_type 허용값

PlayAuto API 문서 기준:
- `옵션없음`: 옵션이 없는 단일상품
- `조합형`: 옵션명/옵션값 조합 (예: 색상-빨강, 색상-파랑)
- `독립형`: 각 옵션이 독립적 (예: 색상:빨강, 사이즈:Large)

> ⚠️ **쿠팡 주의**: 쿠팡은 **독립형 옵션 미지원**. 독립형으로 설정 시 '옵션없음' 상품으로 등록됨

## 채널별 옵션 설정 코드

```python
# 옥션/지마켓: 단일상품 (옵션없음)
std_ol_yn = "Y"
opt_type = "옵션없음"
opts = []

# 쿠팡: 조합형 옵션 필수 + 추천옵션 사용
std_ol_yn = "N"
opt_type = "조합형"
opts = [{"opt_sort1": "수량", "opt_sort1_desc": "1개", "stock_cnt": 999, "status": "정상"}]

# 스마트스토어 등: 독립형 옵션
std_ol_yn = "N"
opt_type = "독립형"
opts = [{"opt_sort1": "상품선택", "opt_sort1_desc": "상품명", "stock_cnt": 999, "status": "정상"}]
```

---

## 미해결 이슈: 쿠팡 상품 등록 오류

**현상**:
```
m20260208e0ff1c763, []. 필수 구매 옵션이 존재하지 않습니다.
```

**쿠팡 쇼핑몰상품 제한 사항** (PlayAuto 공식):
1. 엑셀 일괄 수정, 마스터상품을 이용한 연동 쇼핑몰상품 수정을 이용한 옵션정보 수정 미지원
2. **카테고리 선택 시 추천옵션 사용 또는 직접입력으로 사용 가능**
3. 독립형 옵션 사용 불가
4. 입력형 옵션 사용 불가
5. 추가구매옵션 설정 불가
6. 로켓배송/그로스 설정 가능(단, 상품관련 기능에 한함)
7. 쇼핑몰 자체 지원 기능인 자동생성옵션이 설정된 상품은 옵션정보 수정 미지원

### 디버깅 과정 (2026-02-08)

| 단계 | 시도 내용 | 결과 |
|------|----------|------|
| 1 | `opt_type = "옵션없음"` | ❌ 필수 구매 옵션 오류 |
| 2 | `opt_type = "독립형"` | ❌ 쿠팡 미지원 (옵션없음으로 자동 변경) |
| 3 | `opt_type = "조합형"` + `opt_sort1 = "상품선택"` | ❌ 동일 오류 |
| 4 | shop_cd 확인 → **B378** 발견 | ✅ coupang_codes에 추가 |
| 5 | 추천옵션 확인 → `수량` 필수, 추천단위 `개` | ✅ 옵션 변경 |
| 6 | `opt_sort1 = "수량"`, `opt_sort1_desc = "1개"` | ❌ 여전히 동일 오류 |

**현재 옵션 구조**:
```json
{
  "opt_type": "조합형",
  "std_ol_yn": "N",
  "opts": [
    {
      "opt_sort1": "수량",
      "opt_sort1_desc": "1개",
      "stock_cnt": 999,
      "status": "정상"
    }
  ]
}
```

### F12 콘솔 디버깅 방법

```
상품 등록 시 F12 → Console 탭에서 확인:

[채널 분류] 상품: 상품명
받은 site_list: ['A001', 'A006', 'A077', 'B378']
옥션/지마켓: ['A001', 'A006']
쿠팡: ['B378']
스마트스토어: ['A077']

[쿠팡 디버그] 상품: 상품명
opt_type: 조합형
std_ol_yn: N
opts: [{opt_sort1: "수량", opt_sort1_desc: "1개", ...}]
```

### 관련 파일

- `backend/api/products.py` - 채널별 분기 처리, coupang_codes 정의
- `backend/playauto/product_registration.py` - 옵션 설정 (build_product_data_from_db)
- `add.pdf` - PlayAuto API 문서

### 진행 상황

- [x] shop_cd B378 추가
- [x] 추천옵션 수량/1개 적용
- [x] 디버깅 로그 추가 (프론트엔드 콘솔)
- [ ] **PlayAuto 고객센터 문의 완료** (2026-02-08, 답변 대기 중)

### 추가 확인 필요 사항

- [ ] PlayAuto 쿠팡 템플릿에서 옵션 설정 확인
- [ ] opts 배열에 add_price, sku_cd 등 추가 필드 필요 여부
- [ ] 쿠팡 카테고리별 필수 옵션 형식 확인

---

## 카테고리 매핑

카테고리 매핑 데이터 내보내기:
```bash
# 프로젝트 루트에 엑셀 파일 생성됨
PlayAuto_카테고리_매핑.xlsx
```

**참고 문서**:
- [카테고리 이슈](./md/PLAYAUTO_CATEGORY_ISSUE.md)
- [API 문서](./md/PLAYAUTO_API_DOCUMENTATION.md)
